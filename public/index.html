<!doctype html>
<html lang="en">
  <head>
    <title>CS4241 Assignment 2</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="css/style.css">
    
  </head>
  <body>
    <iframe name="hiddenFrame" width="0" height="0" border="0" style="display: none;"></iframe>
    <form id ="data" action="/data" method="POST" target="hiddenFrame">
      <input type="text" id="model" name="model" placeholder="Model here">
      <input type="number" id="year" name="year" placeholder="Year here">
      <input type="number" id="mpg" name="mpg" placeholder="MPG here">
    </form>
    <button id="submit" class="inputbutton" onclick="submitNClear()" > Submit </button>
    <button id="modify" class="inputbutton" onclick="modify()" > Modify </button>
    <button id="delete" class="inputbutton" onclick="deleteData()" > Delete </button>
    <table id = "table">
    <th>Model</th>
    <th>Year</th> 
    <th>MPG</th>
    <th>Age</th>
    </table>
    <p><a href="/reset">Reset</a> | <a href="/clear">Clear</a></p>
  </body>
  
  <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js" ></script>
  
  <script>

    function reset(){
      console.log("Resetting table");
      document.getElementById('resetForm').submit()
      reloadData()
    }
    
    function clear(){
      //<form id ="clearForm" action="/clear" method="POST" target="hiddenFrame"> <button id="clear" onclick="reloadData()"> Clear </button></form>
      console.log("Clearing Table");
      document.getElementById('clearForm').submit()
      reloadData()
    }
    
  function deleteData(){
    if(document.querySelector('#model').value == ''){
      alert("Enter the model you with to delete")
      return false
    }
    
      if(!checkIfIn(document.querySelector('#model').value)){
        alert("That model is already not in the table")
        return false
      }
      document.getElementById('data').action = '/delete'
      console.log(document.getElementById('data').action)
      document.getElementById('data').submit()
      document.getElementById('data').reset()
      $("#table_of_items tr").remove();
     reloadData()
  }
    
  function modify(){
    if(document.querySelector('#model').value!= '' && document.querySelector( '#year').value !='' && document.querySelector( '#mpg').value != '') {
      if(isNaN(document.querySelector( '#year').value) || isNaN(document.querySelector( '#mpg').value)){
        alert("Year and MPG must be numbers")
        return false
      }else if(document.querySelector( '#year').value > 2019){
        alert("That year has not occured yet, sorry")
        return false
      }
      
        if(!checkIfIn(document.querySelector('#model').value)){
        alert("You can only modify car models that are in the table")
        return false
      }
      document.getElementById('data').action = '/modify'
      document.getElementById('data').submit()
      document.getElementById('data').reset()
      $("#table_of_items tr").remove();
      reloadData()
    return false
    }else{
      alert("Please fill in all text boxes to modify an entry")
    }
    return false
  }
    
  function submitNClear(){
    console.log(document.querySelector('#model'))
    if(document.querySelector('#model').value!= '' && document.querySelector( '#year').value !='' && document.querySelector( '#mpg').value != '') {
      if(isNaN(document.querySelector( '#year').value) || isNaN(document.querySelector( '#mpg').value)){
        alert("Year and MPG must be numbers")
        return false
      } else if(document.querySelector( '#year').value > 2019){
        alert("That year has not occured yet, sorry")
        return false
      }
      
      if(checkIfIn(document.querySelector('#model').value)){
        alert("That model is already in the table")
        return false
      }
      
      document.getElementById('data').submit()
      document.getElementById('data').reset()
      $("#table_of_items tr").remove();
      reloadData()
    return false
    }else{
      alert("Please fill in all text boxes")
    }
    return false
  } 
     
    
  function reloadData(){
    console.log("Getting Data");
    $.get('/data', function(data) {
      clearTable(document.getElementById("table").rows.length - 1)
      data.forEach(function(car){
        console.log(car)
        $('#table').append('<tr><td>' + car[0] +'</td><td>' + car[1] +'</td><td>' + car[2] +'</td><td>'+ car[3] +'</td></tr>')             
      })
    });
  }
    
  function clearTable(rowNum){
    for(let i = 0; i < rowNum; i++)
      document.getElementById("table").deleteRow(1)
  }
    
 function checkIfIn(model){
   console.log(model)
    for(let i = 1; i<document.getElementById("table").rows.length;i++){
      console.log(document.getElementById("table").rows[i].cells[0].innerText)
      if(document.getElementById("table").rows[i].cells[0].innerText == model)
         return true
    }
      return false;
  }
    
  window.onload = function() {
    reloadData()
  }
    
  </script>
  
  
</html>
